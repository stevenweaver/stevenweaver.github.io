<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using Kraken on Galaxy | Steven Weaver</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/10.styles.b2da27b5.css" as="style"><link rel="preload" href="/assets/js/app.5dce5a76.js" as="script"><link rel="preload" href="/assets/js/0.92f7c1ee.js" as="script"><link rel="prefetch" href="/assets/js/1.60a6c42b.js"><link rel="prefetch" href="/assets/js/2.973ac71a.js"><link rel="prefetch" href="/assets/js/3.9730eb2d.js"><link rel="prefetch" href="/assets/js/4.314c7490.js"><link rel="prefetch" href="/assets/js/5.999d0e42.js"><link rel="prefetch" href="/assets/js/6.69febbce.js"><link rel="prefetch" href="/assets/js/7.4fc629ee.js"><link rel="prefetch" href="/assets/js/8.9df1a176.js"><link rel="prefetch" href="/assets/js/9.2d805ebf.js">
    <link rel="stylesheet" href="/assets/css/10.styles.b2da27b5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Steven Weaver
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/stevenweaver" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://twitter.com/maximumsteve" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/stevenweaver" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://twitter.com/maximumsteve" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav><ul class="sidebar-links"><li><a href="/publications.html" class="sidebar-link">Publications</a></li><li><a href="/misc/quotations.html" class="sidebar-link">Quotes</a></li><li><a href="/tutorials/kraken.html" class="active sidebar-link">Tutorials - Kraken</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tutorials/kraken.html#brief-introduction" class="sidebar-link">Brief Introduction</a></li><li class="sidebar-sub-header"><a href="/tutorials/kraken.html#selecting-metagenomic-data-for-use" class="sidebar-link">Selecting Metagenomic Data for Use</a></li><li class="sidebar-sub-header"><a href="/tutorials/kraken.html#using-kraken-on-galaxy-2" class="sidebar-link">Using Kraken on Galaxy</a></li><li class="sidebar-sub-header"><a href="/tutorials/kraken.html#kraken-report-tool" class="sidebar-link">Kraken Report Tool</a></li><li class="sidebar-sub-header"><a href="/tutorials/kraken.html#kraken-filtering-options" class="sidebar-link">Kraken Filtering Options</a></li><li class="sidebar-sub-header"><a href="/tutorials/kraken.html#questions-to-ponder" class="sidebar-link">Questions to Ponder</a></li></ul></li><li><a href="/av/" class="sidebar-link">Books, Audio, and Visual</a></li></ul></div><div class="page"><div class="content"><h1 id="using-kraken-on-galaxy"><a href="#using-kraken-on-galaxy" aria-hidden="true" class="header-anchor">#</a> Using Kraken on Galaxy</h1><h2 id="brief-introduction"><a href="#brief-introduction" aria-hidden="true" class="header-anchor">#</a> Brief Introduction</h2><p>Today, we will introduce Kraken, a tool for metagenomic classification. Kraken
attempts to address the speed performance shortcomings of BLAST, and the
sensitivity shortcomings of MetaPhlAn. In order to focus on the application
itself instead of potential installation and configuration hurdles, we will be
using Galaxy to conduct this tutorial.</p><p>To begin, we will find datasets from two different sequencing platforms, one from
454, and another from Illumina. NCBI BioProject and NCBI SRA, a sequence read data archive,
are practical resources to use for obtaining metagenomic, among other, data.</p><h2 id="selecting-metagenomic-data-for-use"><a href="#selecting-metagenomic-data-for-use" aria-hidden="true" class="header-anchor">#</a> Selecting Metagenomic Data for Use</h2><ol><li>In your favorite web browser (preferably one that respects your privacy and digital freedom), navigate to the <a href="https://www.ncbi.nlm.nih.gov/bioproject/browse/" target="_blank" rel="noopener noreferrer">BioProject Browse Page<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li><li>Under the <code>Project Data Type</code> menu, select <code>Metagenome</code>.</li><li>The author of this tutorial is not particularly anthroprocentric, and does enjoy relaxation, so let us choose the hot springs metagenome project.</li><li>In order to give us more flexibility in selecting runs to use, let us use the parent project PRJNA20821</li></ol><p>We will use the following datasets for the rest of the tutorial.</p><ul><li><a href="https://www.ncbi.nlm.nih.gov/sra/SRX1499016%5Baccn%5D" target="_blank" rel="noopener noreferrer">SRR3050168 Illumina WGS Run<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://www.ncbi.nlm.nih.gov/sra/SRX1458051%5Baccn%5D" target="_blank" rel="noopener noreferrer">SRR2968624 16s 454 Run<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><h2 id="using-kraken-on-galaxy-2"><a href="#using-kraken-on-galaxy-2" aria-hidden="true" class="header-anchor">#</a> Using Kraken on Galaxy</h2><ol><li>Create a new history and rename it to Metagenomic Analysis</li><li>Click <code>Extract reads (FASTQ)</code> on the left hand side under NCBI SRA Tools. If you have trouble finding it, you can always search for it in the &quot;search tools&quot; section.</li><li>Once you have retrieved your reads from NCBI SRA, rename them on the right hand side so that you don't confuse yourself later. If you don't, please google HXB2 contamination to see what happens when you are careless about labeling.</li><li>Under <code>Metagenomic Analysis</code>, select <code>Kraken</code>.</li></ol><ul><li>Since we are looking at hot spring data, we are most likely interested in bacterial diversity.</li><li>We will select the quick operation due to the minimal loss in sensitivity for greatly increased gain in speed.</li></ul><h2 id="kraken-report-tool"><a href="#kraken-report-tool" aria-hidden="true" class="header-anchor">#</a> Kraken Report Tool</h2><p>The raw output from Kraken is a bit unwieldy to work with, so we will want to
use tools like Kraken Report.</p><ol><li>Click the search field on the left hand side of Galaxy</li><li>Search &quot;kraken-report&quot;</li><li>Select the Kraken output you wish to receive a report for</li><li>Run and profit</li></ol><p>Let's take a look at the top hits
<img src="/assets/img/illumina_results.38acc8b5.png" alt="Illumina Results"></p><p>First, we must be able to interpret each column</p><ol><li>Percentage of reads covered by the clade rooted at this taxon</li><li>Number of reads covered by the clade rooted at this taxon</li><li>Number of reads assigned directly to this taxon</li><li>A rank code, indicating (U)nclassified, (D)omain, (K)ingdom, (P)hylum, (C)lass, (O)rder, (F)amily, (G)enus, or (S)pecies. All other ranks are simply '-'.</li><li>NCBI taxonomy ID</li><li>indented scientific name</li></ol><p>We can see that of the species classified, 228210 were Alteromonas macleodii str. 'Ionian Sea U8'.
599478 was not classified at all.</p><p>454 Results
<img src="/assets/img/454_results.c87c994c.png" alt="454 Results">
With the 454 dataset, we see that Kraken was able to classify 97.17% as Sulfolobus tokodaii str. 7.</p><h2 id="kraken-filtering-options"><a href="#kraken-filtering-options" aria-hidden="true" class="header-anchor">#</a> Kraken Filtering Options</h2><p>We can also use Kraken filtering options select the most abundant classifications according to rank code.</p><ol><li>Click the search field on the left hand side of Galaxy</li><li>Search &quot;kraken-filter&quot;</li><li>Select the original Kraken dataset</li><li>Run kraken-report on resulting filtered dataset</li></ol><p>Kraken filters using scores. A sequence label's score is a fraction C/Q, where C
is the number of k-mers mapped to LCA values in the clade rooted at the label,
and Q is the number of k-mers in the sequence that lack an ambiguous nucleotide
(i.e., they were queried against the database).</p><p>Notice that the results are not as granular, and that we lose quite a bit of classification, by setting the filtering score to .2
<img src="/assets/img/illumina_filter.20b13378.png" alt="Illumina Filter"></p><p>Filtering on 454 data isn't as drastic, but it is still substantial
<img src="/assets/img/454_filter.bbd8c367.png" alt="454 Filter"></p><p>If we elect to filter and sort data using Galaxy, we can use filter based on
column 4 (the rank code), and then select sort on number of reads covered by the
clade rooted at the taxon. An example using species on the Illumina dataset is
shown below:</p><p><img src="/assets/img/illumina_species.b9b1c66e.png" alt="Illumina Species"></p><p>And if we sort by Family (please note you want to sort by the <em>second</em> column)
</p><p>I do not have a screenshot of this due to the Galaxy site being unavailable on
Tuesday 20170509.</p><h2 id="questions-to-ponder"><a href="#questions-to-ponder" aria-hidden="true" class="header-anchor">#</a> Questions to Ponder</h2><h3 id="the-importance-of-knowing-the-source-of-your-data"><a href="#the-importance-of-knowing-the-source-of-your-data" aria-hidden="true" class="header-anchor">#</a> The importance of knowing the source of your data</h3><p>One question that we must keep in mind when doing metagenomic analysis is what
sort of machine and method was used to sequence the data in the first place. We
can see how much more successful Kraken was at identifying the 16S results. This
is because the 16S rRNA gene is highly conserved across different species of
bacteria and archaea.</p><p>Please note that this conclusion is <em>not</em> universal, and it depends on the
<em>context</em> of the experiment you are conducting. Despite increased depth with 16s
sequencing, the researcher is potentially sacrificing signal in detecting a
wider range of bacterial diversity. I urge the reader to read journal
publications discussing the strengths and limitations of both methods.</p><h3 id="additional-kraken-parameters"><a href="#additional-kraken-parameters" aria-hidden="true" class="header-anchor">#</a> Additional Kraken Parameters</h3><p>Please consider the Kraken database you select when using the application.
Notice that you will not classify data accurately at all if you are using the
wrong database.</p><p>Illumina Wrong Reference Database
<img src="/assets/img/illumina_unc.17517e3a.png" alt="Illumina Filter"></p><p>454 Wrong Reference Database
<img src="/assets/img/454_unc.68974650.png" alt="454 Filter"></p><p>Unfortunately, Galaxy does not report how long each job takes, so we cannot
compare the times between the quick operation and Kraken original. We can,
however, notice that the classification difference is minimal. If you are in a
rush, you may want to choose the quick operation for little cost in sensitivity.</p></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/misc/quotations.html" class="prev">
          Quotes
        </a></span><span class="next"><a href="/av/">
          Books, Audio, and Visual
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/0.92f7c1ee.js" defer></script><script src="/assets/js/app.5dce5a76.js" defer></script>
  </body>
</html>
